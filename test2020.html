<html>

<head>
  <style>

  </style>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js' type='text/javascript'></script>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css' media='all'
    rel='stylesheet' />
  <link rel='stylesheet'
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.3/css/bootstrap-colorpicker.min.css">
  </link>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.3/js/bootstrap-colorpicker.min.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js'></script>

  <style>
  #canvas {
    width: 100%;
    max-height: 500px;
    object-fit: contain;
    margin-bottom: 10px;
}
    #dieuchinh,
    #themlayer,
    #chonnen,
    #upanhlen {
      display: none;
    }

    .chonanh-avt {
      width: 38px;
      height: 38px;
      float: left;
      border: 1px solid #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin-right: 10px;
    }

    .img-preview {
      width: 36px;
      height: 36px;
      background-image: url(//2.bp.blogspot.com/-ZTMZs1MahXE/XqZq3WgQKDI/AAAAAAAAdRI/ib4MFhw49m82VLY9b2LzZBw5w3tItLSrQCK4BGAYYCw/s36/thumbnail-man.png);
      background-size: 36px;
      background-position: center;
    }

   
  </style>
</head>

<body>

  <div class="container">


    <div class="row">

      <div class="col-lg-6">



        <div>
          <div class="chonanh-avt">
            <div class="img-preview avt-chonnen"></div>
          </div>
          <label for="chonnen" class="btn btn-primary">
            Chọn nền
          </label>

          <input type="file" id="chonnen">
        </div>
        <canvas id="canvas" style="border:1px solid #333" width="500" height="500"></canvas>
      </div>



      <div class="col-lg-6">
        <div id="themlayer">
          <div class="chonanh-avt">
            <div class="img-preview avt-upanhlen"></div>
          </div>
          <label for="upanhlen" class="btn btn-primary">Chọn ảnh</label>
          <div>
            <input type="file" id="upanhlen">
          </div>



          <div id="dieuchinh">

            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Profile</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">Contact</a>
              </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
              <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">            <div id="dieuchinhX">
                <label>Toạ độ ngang (X) <span class="badge badge-primary">0</span></label>
                <input type="range" min=-50 value=0 max=1000 step=1 class="custom-range dieuchinh">
              </div>
              <div id="dieuchinhY">
                <label>Toạ độ dọc (Y) <span class="badge badge-primary">0</span></label>
                <input type="range" min=-50 value=0 max=1000 step=1 class="custom-range dieuchinh">
              </div></div>
              <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">...</div>
              <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">...</div>
            </div>





            <label>Hoạ trộn (Blend Mode)</label>
            <select class="custom-select mb-3 dieuchinh" id="dieuchinhHoatron">
              <option selected>normal</option>
              <option value="multiply">multiply</option>
              <option value="screen">screen</option>
              <option value="darken">darken</option>
              <option value="lighten">lighten</option>
              <option value="color-dodge">color-dodge</option>
              <option value="color-burn">color-burn</option>
              <option value="hard-light">hard-light</option>
              <option value="soft-light">soft-light</option>
              <option value="difference">difference</option>
              <option value="exclusion">exclusion</option>
              <option value="hue">hue</option>
              <option value="saturation">saturation</option>
              <option value="color">color</option>
              <option value="luminosity">luminosity</option>

            </select>
            <div id="dieuchinhOpa">
              <label>Độ trong suốt (Opacity) <span class="badge badge-primary">100%</span></label>
              <input type="range" min=0.1 value=1 max=1 step=0.01 class="custom-range dieuchinh"><br>
            </div>


            <div id="dieuchinhXoay">
              <label>Xoay (X) <span class="badge badge-primary">0</span></label>
              <input type="range" min=-360 value=0 max=360 step=1 class="custom-range dieuchinh">
            </div>


            <div id="dieuchinhScale">
              <label>Thu phóng (Zoom) <span class="badge badge-primary">0.8x</span></label>
              <input type="range" min=0.1 value=0.8 max=5 step=0.1 class="custom-range dieuchinh"><br>
            </div>
          </div>




          <div id="dieuchinhchu">

            <div id="themtext">
              <input type="text" class="form-control dieuchinh" id="nhaptext" placeholder="First name"><br />
            </div>

            <div id="dieuchinhchuColor">
              <label>Màu chữ (Color)<span class="badge badge-primary">50px</span></label>
              <input type="text" value=red class="form-control dieuchinh"><br>
            </div>
            <div id="dieuchinhchuSize">
              <label>Cỡ chữ(Size) <span class="badge badge-primary">50px</span></label>
              <input type="range" min=1 value=50 max=300 step=1 class="custom-range dieuchinh"><br>
            </div>
            <div id="dieuchinhchuX">
              <label>Toạ độ ngang (X) <span class="badge badge-primary">0</span></label>
              <input type="range" min=-50 value=0 max=1000 step=1 class="custom-range dieuchinh">
            </div>
            <div id="dieuchinhchuY">
              <label>Toạ độ dọc (Y) <span class="badge badge-primary">0</span></label>
              <input type="range" min=-50 value=0 max=1000 step=1 class="custom-range dieuchinh">
            </div>
            <label>Hoạ trộn (Blend Mode)</label>
            <select class="custom-select mb-3 dieuchinh" id="dieuchinhchuHoatron">
              <option selected>normal</option>
              <option value="multiply">multiply</option>
              <option value="screen">screen</option>
              <option value="darken">darken</option>
              <option value="lighten">lighten</option>
              <option value="color-dodge">color-dodge</option>
              <option value="color-burn">color-burn</option>
              <option value="hard-light">hard-light</option>
              <option value="soft-light">soft-light</option>
              <option value="difference">difference</option>
              <option value="exclusion">exclusion</option>
              <option value="hue">hue</option>
              <option value="saturation">saturation</option>
              <option value="color">color</option>
              <option value="luminosity">luminosity</option>

            </select>
            <div id="dieuchinhchuOpa">
              <label>Độ trong suốt (Opacity) <span class="badge badge-primary">100%</span></label>
              <input type="range" min=0.1 value=1 max=1 step=0.01 class="custom-range dieuchinh"><br>
            </div>

          </div>
        </div>
        <br />

      </div>

      <button class="btn btn-primary" id="taoxong">Xong</button>
      <button class="btn btn-primary" id="quaylai">Chỉnh tiếp</button>
    </div>
  </div>


  <img src="" id="img1" style="display: none;"></img>
  <img src="" id="img2" style="display: none;"></img>

  <script type="text/javascript">
    //Khai bao
    var img1 = document.getElementById('img1');
    var img2 = document.getElementById('img2');
    var canvas = document.getElementById('canvas');
    var x, y, scale, xoay, toadoX, toadoY, DcScale, HoaTron, Dotrong, Dcxoay = 0
    var HoaTron = "normal";
    var Dotrong = 1
    var cwidth = 0;
    var cheight = 0;



    //chuc nang chinh chu



    $('#dieuchinhchuColor input').colorpicker({ format: 'hex', colorSelectors: { 'black': '#000000', 
    'white': '#ffffff', 'red': '#f44336', 'pink': '#e91e63', 'purple': '#673ab7', 'blue': '#3f51b5', 
    'cyan': '#00bcd4', 'green': '#009688', 'yellow': '#ffc107', 'orange': '#ff5722' }});

    $("#dieuchinhchu .dieuchinh").on("input", function () {

      var ndChu = $("#nhaptext").val();

      Mauchu = $("#dieuchinhchuColor input").val();

      toadochuX = $("#dieuchinhchuX input").val();

      $("#dieuchinhchuX span").text(toadochuX + "px");

      toadochuY = $("#dieuchinhchuY input").val();

      $("#dieuchinhchuY span").text(toadochuY + "px");

      DcSizechu = $("#dieuchinhchuSize input").val();
      $("#dieuchinhchuSize span").text(DcSizechu + "px");


      HoaTronchu = $("#dieuchinhchuHoatron").val();

      Dotrongchu = $("#dieuchinhchuOpa input").val();
      $("#dieuchinhchuOpa span").text(parseInt(Dotrongchu * 100) + "%");

      Dcxoaychu = $("#dieuchinhchuXoay input").val();

      $("#dieuchinhchuXoay span").text(Dcxoaychu + "º");

      Vietchu(ndChu, Mauchu, DcSizechu, toadochuX, toadochuY, HoaTron, Dotrongchu, xoay);
    });

    //chuc nang viet chu


    //vietchu
    function Vietchu(ndChu, colortext, DcSizechu, x, y, HoaTron, Dotrongchu, xoay) {
      var ctx = canvas.getContext('2d');


      ctx.save();
      ctx.drawImage(img1, 0, 0);
      ctx.restore();

      ctx.save();
      ctx.translate(x, y);
      ctx.globalCompositeOperation = HoaTronchu;
      ctx.globalAlpha = Dotrongchu;
      ctx.font = DcSizechu + "px Arial";
      ctx.fillStyle = colortext;
      ctx.textAlign = "center";
      ctx.fillText(ndChu, img1.width / 2, img1.height / 2);

      ctx.restore();
    }




    //chuc nang di chuyen anh


    $("#dieuchinh .dieuchinh").on("input", function () {

      toadoX = $("#dieuchinhX input").val();

      $("#dieuchinhX span").text(toadoX + "px");

      toadoY = $("#dieuchinhY input").val();

      $("#dieuchinhY span").text(toadoY + "px");

      DcScale = $("#dieuchinhScale input").val();
      $("#dieuchinhScale span").text(DcScale + "x");


      HoaTron = $("#dieuchinhHoatron").val();

      Dotrong = $("#dieuchinhOpa input").val();
      $("#dieuchinhOpa span").text(parseInt(Dotrong * 100) + "%");

      Dcxoay = $("#dieuchinhXoay input").val();

      $("#dieuchinhXoay span").text(Dcxoay + "º");

      draw(toadoX, toadoY, DcScale, HoaTron, Dotrong, Dcxoay);
    });





    //upnen
    document.getElementById('chonnen').onchange = function (e) {
      $("#themlayer").slideDown();
      img1.onload = Vechonnen;
      img1.onerror = failed;
      img1.src = URL.createObjectURL(this.files[0]);

    };

    //up anh


    document.getElementById('upanhlen').onchange = function (e) {
      $("#dieuchinh").slideDown();
      img2.onload = draw0;
      img2.onerror = failed;
      img2.src = URL.createObjectURL(this.files[0]);
      $(".avt-upanhlen").css("background-image", "url(' " + img2.src + " ')");
    };


    //ve nen
    function Vechonnen() {

      canvas.width = img1.width;
      canvas.height = img1.height;


      $("#dieuchinhX input,#dieuchinhchuX input").attr("max", img1.width).attr("min", "-" + img1.width);
      $("#dieuchinhY input,#dieuchinhchuY input").attr("max", img1.height).attr("min", "-" + img1.height);
      $("#dieuchinhchuSize input").attr("max", img1.height);
      var ctx = canvas.getContext('2d');

      ctx.drawImage(img1, 0, 0);
      draw(toadoX, toadoY, DcScale, HoaTron, Dotrong, Dcxoay);
      $(".avt-chonnen").css("background-image", "url(' " + img1.src + " ')");
    }

    //ve nen lai
    function velai() {

      canvas.width = img1.width;
      canvas.height = img1.height;


      $("#dieuchinhX input").attr("max", img1.width).attr("min", "-" + img1.width);
      $("#dieuchinhY input").attr("max", img1.height).attr("min", "-" + img1.height);

      var ctx = canvas.getContext('2d');

      ctx.drawImage(img1, 0, 0);
      $(".avt-chonnen").css("background-image", "url(' " + img1.src + " ')");

    }

    // ve anh



    function draw0() {
      var ctx = canvas.getContext('2d');
      ctx.save();

      ctx.drawImage(img1, 0, 0);

      ctx.restore();
      ctx.save();
      ctx.translate((img2.width / 2), (img2.height / 2));
      ctx.scale(0.8, 0.8);
      ctx.drawImage(img2, -(img2.width / 2), -(img2.height / 2), img2.width, img2.height);

      ctx.restore();

    }

    function draw(x, y, scale, HoaTron, Dotrong, xoay) {
      var ctx = canvas.getContext('2d');


      ctx.save();
      ctx.drawImage(img1, 0, 0);

      ctx.restore();
      ctx.save();
      ctx.globalCompositeOperation = HoaTron;
      ctx.globalAlpha = Dotrong;

      ctx.translate((img2.width / 2) - x, (img2.height / 2) - y);

      ctx.rotate(xoay * Math.PI / 360);

      ctx.scale(scale, scale);
      ctx.drawImage(img2, -(img2.width / 2), -(img2.height / 2), img2.width, img2.height);
      ctx.restore();
    }



    function failed() {
      console.error("The provided file couldn't be loaded as an Image media");
    }

    // nut tao xong
    $("#taoxong").click(function () {

      canvas.toBlob(function (blob) {
        url = URL.createObjectURL(blob);
        $("#img1").attr("src", url).slideDown();
      });
    });

    //nut quay lai

    $("#quaylai").click(function () {
      velai();
      $("#dieuchinh").slideUp();
      $("#img2").attr("src", "");
      $("#upanhlen").val("");
      $(".avt-upanhlen").attr("style", "");
      $("#dieuchinhX input").val(0);

      $("#dieuchinhX span").text(0 + "px");

      $("#dieuchinhY input").val(0);

      $("#dieuchinhY span").text(0 + "px");

      $("#dieuchinhScale input").val(0.8);
      $("#dieuchinhScale span").text(0.8 + "x");

      $("#dieuchinhHoatron").val("normal");

      $("#dieuchinhOpa input").val(1);

      $("#dieuchinhOpa span").text("100 %");

      Dcxoay = $("#dieuchinhXoay input").val(0);

      $("#dieuchinhXoay span").text("0 º");

    });



// nut tao lai tu dau

  </script>


</body>

</html>