"use strict";(function(d){var f=d.fabric||(d.fabric={}),c="1.6.0",e=function(){return typeof G_vmlCanvasManager!=="undefined"},b=f.util.degreesToRadians,a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7};if(c.localeCompare(d.fabric.version)>-1){console.warn("this extension might not be fully compatible with your version of fabric.js ("+d.fabric.version+").Consider using the latest compatible build of fabric.js (> "+c+")")}f.util.object.extend(f.Object.prototype,{useCustomIcons:false,cornerBackgroundColor:"transparent",cornerShape:"",cornerPadding:0,customiseCornerIcons:function(i,j){var h,g;for(h in i){if(i.hasOwnProperty(h)){g={};if(i[h].cornerShape!==undefined){this.cornerShape=i[h].cornerShape}if(i[h].cornerBackgroundColor!==undefined){this.cornerBackgroundColor=i[h].cornerBackgroundColor}if(i[h].borderColor!==undefined){this.borderColor=i[h].borderColor}if(i[h].cornerSize!==undefined){this.cornerSize=i[h].cornerSize}if(i[h].cornerPadding!==undefined){this.cornerPadding=i[h].cornerPadding}if(i[h].icon!==undefined||Object.keys(i)[0]==="settings"){this.useCustomIcons=true;if(i[h].settings!==undefined){g.settings=i[h].settings}if(i[h].icon!==undefined){g.icon=i[h].icon;this.loadIcon(h,g,function(){if(j&&typeof(j)==="function"){j()}})}}}}},loadIcon:function(j,h,k){var g=this,i=new Image();i.onload=function(){g[j+"Icon"]=this;if(h.settings){g[j+"Settings"]=h.settings}if(k&&typeof(k)==="function"){k()}};i.onerror=function(){f.warn(this.src+" icon is not an image")};if(h.icon.match(/^http[s]?:\/\//)||h.icon.substring(0,2)==="//"){i.crossOrigin="Anonymous"}i.src=h.icon},customizeCornerIcons:function(g){this.customiseCornerIcons(g)},drawControls:function(j){if(!this.hasControls){return this}var i=this._calculateCurrentDimensions(),l=i.x,h=i.y,g=this.cornerSize,n=-(l+g)/2,m=-(h+g)/2,k;if(!this.useCustomIcons){j.lineWidth=1;j.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;j.strokeStyle=j.fillStyle=this.cornerColor;if(!this.transparentCorners){j.strokeStyle=this.cornerStrokeColor}k=this.transparentCorners?"stroke":"fill"}else{k="drawImage"}j.save();this._setLineDash(j,this.cornerDashArray,null);this._drawControl("tl",j,k,n,m,this.tlIcon,this.tlSettings);this._drawControl("tr",j,k,n+l,m,this.trIcon,this.trSettings);this._drawControl("bl",j,k,n,m+h,this.blIcon,this.blSettings);this._drawControl("br",j,k,n+l,m+h,this.brIcon,this.brSettings);if(!this.get("lockUniScaling")){this._drawControl("mt",j,k,n+l/2,m,this.mtIcon,this.mtSettings);this._drawControl("mb",j,k,n+l/2,m+h,this.mbIcon,this.mbSettings);this._drawControl("mr",j,k,n+l,m+h/2,this.mrIcon,this.mrSettings);this._drawControl("ml",j,k,n,m+h/2,this.mlIcon,this.mlSettings)}if(this.hasRotatingPoint){this._drawControl("mtr",j,k,n+l/2,m-this.rotatingPointOffset,this.mtrIcon,this.mtrSettings)}j.restore();return this},_drawControl:function(l,q,o,i,m,n,j){if(!this.isControlVisible(l)){return}var r=this.cornerSize,p=this.cornerStrokeColor||"transparent",h=this.cornerBackgroundColor||"black",k=this.cornerShape||"rect",g=typeof this.cornerPadding==="number"?this.cornerPadding:10;if(j){if(j.cornerSize){i=i+r/2-j.cornerSize/2;m=m+r/2-j.cornerSize/2;r=j.cornerSize}k=j.cornerShape||k;h=j.cornerBackgroundColor||h;g=typeof j.cornerPadding==="number"?j.cornerPadding:g;p=j.cornerStrokeColor||p}if(this.useCustomIcons){if(k){q.globalAlpha=1;q.fillStyle=h;q.lineWidth=1;q.strokeStyle=p;switch(k){case"rect":q.fillRect(i,m,r,r);if(p){q.strokeRect(i,m,r,r)}break;case"circle":q.beginPath();q.arc(i+r/2,m+r/2,r/2,0,2*Math.PI);q.fill();if(p){q.stroke()}q.closePath();break}if(n!==undefined){q[o](n,i+g/2,m+g/2,r-g,r-g)}}else{if(n!==undefined){q[o](n,i,m,r,r)}}}else{e()||this.transparentCorners||q.clearRect(i,m,r,r);q[o+"Rect"](i,m,r,r);if(!this.transparentCorners&&p){q.strokeRect(i,m,r,r)}}}});f.util.object.extend(f.Canvas.prototype,{overwriteActions:false,fixedCursors:false,customiseControls:function(h){var g;for(g in h){if(h.hasOwnProperty(g)){if(h[g].action!==undefined){this.overwriteActions=true;this.setCustomAction(g,h[g].action)}if(h[g].cursor!==undefined){this.fixedCursors=true;this.setCustomCursor(g,h[g].cursor)}}}},setCustomAction:function(g,h){this[g+"Action"]=h},setCustomCursor:function(h,g){this[h+"cursorIcon"]=g},customizeControls:function(g){this.customiseControls(g)},_getActionFromCorner:function(i,g,h){if(!g){return"drag"}if(g){if(this[g+"Action"]&&this.overwriteActions){switch(g){case"mtr":return this[g+"Action"]||"rotate";case"ml":case"mr":if(h[this.altActionKey]){return h[this.altActionKey]?"skewY":"scaleX"}return this[g+"Action"];case"mt":case"mb":if(h[this.altActionKey]){return h[this.altActionKey]?"skewY":"scaleY"}return this[g+"Action"];default:return this[g+"Action"]||"scale"}}else{switch(g){case"mtr":return"rotate";case"ml":case"mr":return h[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return h[this.altActionKey]?"skewX":"scaleY";default:return"scale"}}}return false},_setupCurrentTransform:function(k,j){if(!j){return}var l=this.getPointer(k),h=j._findTargetCorner(this.getPointer(k,true)),i=this._getActionFromCorner(j,h,k),g=this._getOriginFromCorner(j,h);if(typeof i==="function"){i.call(this,k,j);i="void"}this._currentTransform={target:j,action:i,corner:h,scaleX:j.scaleX,scaleY:j.scaleY,skewX:j.skewX,skewY:j.skewY,offsetX:l.x-j.left,offsetY:l.y-j.top,originX:g.x,originY:g.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,left:j.left,top:j.top,theta:b(j.angle),width:j.width*j.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:k.shiftKey,altKey:k[this.centeredKey]};this._currentTransform.original={left:j.left,top:j.top,scaleX:j.scaleX,scaleY:j.scaleY,skewX:j.skewX,skewY:j.skewY,originX:g.x,originY:g.y};if(i==="remove"){this._removeAction(k,j)}if(i==="moveUp"){this._moveLayerUpAction(k,j)}if(i==="moveDown"){this._moveLayerDownAction(k,j)}if(typeof i==="object"){if(Object.keys(i)[0]==="rotateByDegrees"){this._rotateByDegrees(k,j,i.rotateByDegrees)}}this._resetCurrentTransform()},_removeAction:function(h,g){var i=this;if(this.getActiveGroup()&&this.getActiveGroup()!=="undefined"){this.getActiveGroup().forEachObject(function(j){j.off();j.remove()});this.discardActiveGroup();setTimeout(function(){i.deactivateAll()},0)}else{g.off();g.remove();setTimeout(function(){i.deactivateAll()},0)}},_moveLayerUpAction:function(h,g){if(this.getActiveGroup()&&this.getActiveGroup()!=="undefined"){this.getActiveGroup().forEachObject(function(i){i.bringForward()})}else{g.bringForward()}},_moveLayerDownAction:function(h,g){if(this.getActiveGroup()&&this.getActiveGroup()!=="undefined"){this.getActiveGroup().forEachObject(function(i){i.sendBackwards()})}else{g.sendBackwards()}},_rotateByDegrees:function(i,h,g){var j=parseInt(h.getAngle())+g,k=false;if((h.originX!=="center"||h.originY!=="center")&&h.centeredRotation){this._setOriginToCenter(h);k=true}j=j>360?j-360:j;if(this.getActiveGroup()&&this.getActiveGroup()!=="undefined"){this.getActiveGroup().forEachObject(function(l){l.setAngle(j).setCoords()})}else{h.setAngle(j).setCoords()}if(k){this._setCenterToOrigin(h)}this.renderAll()},_setCornerCursor:function(g,i,h){var j=/\.(?:jpe?g|png|gif|jpg|jpeg|svg)$/;if(this.fixedCursors&&this[g+"cursorIcon"]){if(this[g+"cursorIcon"].match(j)){this.setCursor("url("+this[g+"cursorIcon"]+"), auto")}else{if(this[g+"cursorIcon"]==="resize"){this.setCursor(this._getRotatedCornerCursor(g,i,h))}else{this.setCursor(this[g+"cursorIcon"])}}}else{if(g in a){this.setCursor(this._getRotatedCornerCursor(g,i,h))}else{if(g==="mtr"&&i.hasRotatingPoint){this.setCursor(this.rotationCursor)}else{this.setCursor(this.defaultCursor);return false}}}return false}});if(typeof exports!=="undefined"){module.exports=this}})(window);