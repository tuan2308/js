$(document).ready(function(){if(window.location.hostname==tmbq){var h=document.getElementById("Nimg");var l=document.getElementById("Cimg");var k=new Image;k.crossOrigin="Anonymous";k.src=bgimg;var n=new Image;n.crossOrigin="Anonymous";n.src=markimg;var i=0;var g=vitri;$("#tad-taoanh").click(function(){$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");setTimeout(function(){k.onload=f()},200)});function f(){c=document.querySelector("canvas"),ctx=c.getContext("2d"),corners=g,step=1;var A,b,w,m,v,a,d,u,j=l.width-1,e=l.height-1;ctx.clearRect(0,0,c.width,c.height);ctx.save();for(y=0;y<e;y+=step){for(x=0;x<j;x+=step){v=z(corners[0],corners[3],y/e);a=z(corners[1],corners[2],y/e);d=z(corners[0],corners[3],(y+step)/e);u=z(corners[1],corners[2],(y+step)/e);A=z(v,a,x/j);b=z(v,a,(x+step)/j);w=z(d,u,(x+step)/j);m=z(d,u,x/j);ctx.drawImage(l,x,y,step,step,A.x,A.y,Math.ceil(Math.max(step,Math.abs(b.x-A.x),Math.abs(m.x-w.x)))+1,Math.ceil(Math.max(step,Math.abs(A.y-m.y),Math.abs(b.y-w.y)))+1)}}ctx.globalCompositeOperation="destination-in";ctx.drawImage(n,0,0,c.width,c.height);ctx.restore();ctx.save();ctx.globalCompositeOperation="destination-over";ctx.drawImage(k,0,0,c.width,c.height);ctx.restore();if(h){ctx.save();ctx.globalAlpha=0.5;var t=ctx.createPattern(h,"repeat");ctx.fillStyle=t;ctx.fillRect(0,0,c.width,c.height);ctx.restore()}c.toBlob(function(p){var o=URL.createObjectURL(p);$("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='"+o+"' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='"+o+"' class='btn btn-block btn-primary mt-2'  download='taoanhdep_"+tenanhxuat+"'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");$("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");$("#img-out").show()});function z(o,p,q){return{x:o.x+(p.x-o.x)*q,y:o.y+(p.y-o.y)*q}}}}});