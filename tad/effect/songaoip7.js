$(document).ready(function(){if(window.location.hostname==tmbq){$("head").append(cssCrop);$("head").append(jsCrop);$("head").append(jqueryCrop);var k=document.getElementById("Nimg");var h=document.getElementById("Cimg");var g=new Image;g.crossOrigin="Anonymous";g.src=bgimg;var n=new Image;n.crossOrigin="Anonymous";n.src=markimg;var l=0;var i=vitri;$("#tad-taoanh").click(function(){g.src=bgimg;n.src=markimg;i=vitri;$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");setTimeout(function(){g.onload=f()},200)});function f(){c=document.querySelector("canvas"),ctx=c.getContext("2d"),corners=i,step=1;var w,j,b,v,a,e,o,z,u=h.width-1,t=h.height-1;ctx.clearRect(0,0,c.width,c.height);ctx.save();for(y=0;y<t;y+=step){for(x=0;x<u;x+=step){a=m(corners[0],corners[3],y/t);e=m(corners[1],corners[2],y/t);o=m(corners[0],corners[3],(y+step)/t);z=m(corners[1],corners[2],(y+step)/t);w=m(a,e,x/u);j=m(a,e,(x+step)/u);b=m(o,z,(x+step)/u);v=m(o,z,x/u);ctx.drawImage(h,x,y,step,step,w.x,w.y,Math.ceil(Math.max(step,Math.abs(j.x-w.x),Math.abs(v.x-b.x)))+1,Math.ceil(Math.max(step,Math.abs(w.y-v.y),Math.abs(j.y-b.y)))+1)}}ctx.save();ctx.globalAlpha=0.3;ctx.fillStyle="#333";ctx.fillRect(0,0,c.width,c.height);ctx.restore();ctx.globalCompositeOperation="destination-in";ctx.drawImage(n,0,0,c.width,c.height);ctx.restore();ctx.save();ctx.globalCompositeOperation="destination-over";ctx.drawImage(g,0,0,c.width,c.height);ctx.restore();if(k){ctx.save();ctx.globalAlpha=0.5;var d=ctx.createPattern(k,"repeat");ctx.fillStyle=d;ctx.fillRect(0,0,c.width,c.height);ctx.restore()}c.toBlob(function(q){var p=URL.createObjectURL(q);$("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='"+p+"' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='"+p+"' class='btn btn-block btn-primary mt-2' download='taoanhdep_"+tenanhxuat+"'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");$("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");$("#img-out").show()});function m(p,q,r){return{x:p.x+(q.x-p.x)*r,y:p.y+(q.y-p.y)*r}}}}});