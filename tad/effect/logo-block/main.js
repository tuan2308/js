$(document).ready(function(){$("head").append(cssCrop);$("head").append(jsCrop);function o(){$(".chonnen").html("");for(let i=0;i<hinhnen.length;i++){$(".chonnen").append("<div class='col mb-3 text-center'><img alt='Hình nền' class='img-thumbnail' src='"+hinhnen[i]+"'></div>")}$("#cropanh").click(function(){$(".dk1").val(1);$(".chonnen div").removeClass("active")});$(".chonnen div").click(function(){$(".btn-chonnen").html("<i class='fas fa-image'></i> Chọn nền khác");$(".dk1").val(1);$(".chonnen div").removeClass("active");$(this).addClass("active");var d=$(this).children().attr("src").replace(/h240/g,"s1500");h=d;$(".img-container img,.cropper-canvas img, .cropper-view-box img").attr("src",d);$(".img-preview").css("background-image","url("+d+")").css("background-size","cover").css("background-position","center");$("#chonanhModal").modal("hide")})}$(".btn-chonnen").one("click",function(){o()});var a="SVN-Suargie";var p="200px";var n=false;var b=1;var h="";$("#font1").click(function(){a="SVN-Suargie";p="200px"});$("#font2").click(function(){a="UTM Alpine KT";p="170px"});$("#font3").click(function(){a="SVN-Skill";p="220px"});$("#dong1").click(function(){b=1;$(".tad-in-text2").hide();$(".tad-in-text3").hide();j()});$("#dong2").click(function(){b=2;$(".tad-in-text2").show();$(".tad-in-text3").hide();j()});$("#dong3").click(function(){b=3;$(".tad-in-text2").show();$(".tad-in-text3").show();j()});var f=$(".tad-in-text1");var k=$(".tad-in-text2");var l=$(".tad-in-text3");f.on("input",function(){j()});k.on("input",function(){j()});l.on("input",function(){j()});function j(){if(b==1){if(f.val().length==0){$("#tad-taoanh").addClass("disabled")}else{$("#tad-taoanh").removeClass("disabled")}}if(b==2){if(f.val().length==0||k.val().length==0){$("#tad-taoanh").addClass("disabled")}else{$("#tad-taoanh").removeClass("disabled")}}if(b==3){if(f.val().length==0||k.val().length==0||l.val().length==0){$("#tad-taoanh").addClass("disabled")}else{$("#tad-taoanh").removeClass("disabled")}}}let isVisible=false;$("#phatsang").click(function(){n=isVisible;isVisible=!isVisible});function m(){document.fonts.load("10pt '"+a+"'").then(function(){document.fonts.load('10pt "Montserrat"').then(function(){var d=new Image();d.crossOrigin="Anonymous";d.src=h;d.onload=function(){var t=document.getElementById("temp");var e=t.getContext("2d");e.save();e.drawImage(d,0,0,t.width,t.height);e.restore();e.save();e.fillStyle="rgba(30,30,30,0.5)";e.fillRect(0,0,t.width,t.height);e.restore();var r=$(".tad-in-text1").val();var q=$(".tad-in-text2").val();var g=$(".tad-in-text3").val();var s=p+" "+a;e.save();if(n==false){e.shadowBlur=30;e.shadowColor="rgba(255,255,255, 0.8)"}if(b==1){e.save();e.fillStyle="#fff";e.textAlign="center";e.textBaseline="middle";e.font=s;e.fillText(r,t.width/2,t.height/2+50);e.restore()}if(b==2){e.save();e.fillStyle="#fff";e.textAlign="center";e.textBaseline="middle";e.font=s;e.fillText(r,t.width/2,t.height/2+30);e.restore();e.save();e.fillStyle="#fff";e.textAlign="center";e.textBaseline="middle";e.font="50px Montserrat";e.fillText(q,t.width/2,t.height/2+120);e.restore()}if(b==3){e.save();e.fillStyle="#fff";e.textAlign="center";e.textBaseline="middle";e.font=s;e.fillText(r,t.width/2,t.height/2+10);e.restore();e.save();e.fillStyle="#fff";e.textAlign="center";e.textBaseline="middle";e.font="50px Montserrat";e.fillText(q,t.width/2,t.height/2+100);e.restore();e.save();e.fillStyle="#fff";e.textAlign="center";e.textBaseline="middle";e.font="40px Montserrat";e.fillText(g,t.width/2,t.height/2+170);e.restore()}e.restore();tadUpload(t)}})})}m();$("body").append('<input class="dk1 d-none" value="">');var c=$(".dk1").val();$("#tad-taoanh").click(function(){if($(".dk1").val()==""){alert("Vui lòng chọn nền");o();$("#chonanhModal").modal("show");return false}$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");m()});window.onload=function(){var r=window.Cropper;var t=window.URL||window.webkitURL;var y=document.querySelector(".img-container");var x=y.getElementsByTagName("img").item(0);var v=document.getElementById("actions");var q={aspectRatio:tyle,viewMode:vmode,autoCrop:true,strict:true,background:true,autoCropArea:1};var z=new r(x,q);var w=x.src;var A="image/jpeg";var u;if(!document.createElement("canvas").getContext){$('button[data-method="getCroppedCanvas"]').prop("disabled",true)}if(typeof document.createElement("cropper").style.transition==="undefined"){$('button[data-method="rotate"]').prop("disabled",true);$('button[data-method="scale"]').prop("disabled",true)}v.querySelector(".docs-buttons").onclick=function(E){var g=E||window.event;var B=g.target||g.srcElement;var C;var e;var d;var D;if(!z){return}while(B!==this){if(B.getAttribute("data-method")){break}B=B.parentNode}if(B===this||B.disabled||B.className.indexOf("disabled")>-1){return}D={method:B.getAttribute("data-method"),target:B.getAttribute("data-target"),option:B.getAttribute("data-option")||undefined,secondOption:B.getAttribute("data-second-option")||undefined};C=z.cropped;if(D.method){if(typeof D.target!=="undefined"){d=document.querySelector(D.target);if(!B.hasAttribute("data-option")&&D.target&&d){try{D.option=JSON.parse(d.value)}catch(g){console.log(g.message)}}}switch(D.method){case"rotate":if(C){z.clear()}break;case"getCroppedCanvas":try{D.option=JSON.parse(D.option)}catch(g){console.log(g.message)}if(A==="image/jpeg"){if(!D.option){D.option={}}D.option.fillColor="#fff"}break}e=z[D.method](D.option,D.secondOption);switch(D.method){case"rotate":if(C){z.crop()}break;case"scaleX":case"scaleY":B.setAttribute("data-option",-D.option);break;case"getCroppedCanvas":if(e){e.toBlob(function(F){var G=URL.createObjectURL(F);$(".img-preview").css("background-image","url("+G+")").css("background-size","cover").css("background-position","center");h=G})}break;case"destroy":z=null;if(u){t.revokeObjectURL(u);u="";x.src=w}break}if(typeof e==="object"&&e!==z&&d){try{d.value=JSON.stringify(e)}catch(g){console.log(g.message)}}}};document.body.onkeydown=function(e){var d=e||window.event;if(!z||this.scrollTop>300){return}switch(d.keyCode){case 37:d.preventDefault();z.move(-1,0);break;case 38:d.preventDefault();z.move(0,-1);break;case 39:d.preventDefault();z.move(1,0);break;case 40:d.preventDefault();z.move(0,1);break}};$(".cropanh-container").hide();var s=document.getElementById("inputImage");if(t){s.onchange=function(){var d=this.files;var e;if(z&&d&&d.length){e=d[0];if(/^image\/\w+/.test(e.type)){A=e.type;if(u){t.revokeObjectURL(u)}x.src=u=t.createObjectURL(e);z.destroy();z=new r(x,q);s.value=null;$(".cropanh-container").show();$(".btn-upanh span,.btn-chonanh").html("<i class='fas fa-upload'></i> Chọn ảnh khác")}else{window.alert("Vui lòng chọn một tệp hình ảnh.")}}}}else{s.disabled=true;s.parentNode.className+=" disabled"}}});