<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link as='style' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css'
        media='all' rel='stylesheet' />

    <script crossorigin='anonymous'
        integrity='sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=='
        src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js'></script>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" media="all">

</head>

<body>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css"
        integrity="sha512-0SPWAwpC/17yYyZ/4HSllgaK7/gg9OlVozq8K7rf3J8LvCjYEEIfzzpnA2/SSjpGIunCSD18r3UhvDcu/xncWA=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    <script src="../testcr.js" type="text/javascript"></script>
    <script src="https://cdn.taoanhdep.com/tad/tv/tad-crop.js" type="text/javascript"></script>




    <label>Upload ảnh</label>
    <div class="xulyhinhanh mb-2">
        <div class="chonanh-avt">
            <div class="img-preview" style="width: 36px; height: 36px;"><img crossorigin="anonymous"
                    src="https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png?timestamp=1629977090487"
                    alt="Tạo ảnh đẹp"
                    style="display: block; width: 100px; height: 100px; min-width: 0px !important; min-height: 0px !important; max-width: none !important; max-height: none !important; transform: none;">
            </div>
        </div>
        <button type="button" class="btn btn-primary btn-chonanh" data-toggle="modal" data-target="#chonanhModal">
            <i class="fas fa-upload"></i> Chọn ảnh
        </button>
        <div class="modal fade" id="chonanhModal" tabindex="-1" role="dialog" aria-labelledby="chonanhModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="chonanhModalLabel">Chọn ảnh từ thiết bị</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&#215;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="actions">
                            <div class="docs-buttons">
                                <label class="btn btn-primary btn-upload btn-upanh" for="inputImage"
                                    title="Upload image file">
                                    <input type="file" class="sr-only" id="inputImage" name="file"
                                        accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff">
                                    <span><i class="fas fa-upload"></i> Chọn ảnh</span>
                                </label>
                                <div class="cropanh-container mt-2" style="display:none">
                                    <div class="img-container">
                                        <img alt="Tạo ảnh đẹp"
                                            src="https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png">
                                    </div>
                                    <div class="d-flex float-right">
                                        <div class="btn-group mr-2">
                                            <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="-45" title="Rotate Left">
                                                <i class="fa fa-undo"></i>
                                            </button>
                                            <button type="button" class="btn btn-primary" data-method="rotate"
                                                data-option="45" title="Rotate Right">
                                                <i class="fa fa-redo"></i>
                                            </button>
                                        </div>
                                        <div class="btn-group mr-2">
                                            <button type="button" class="btn btn-primary" data-method="scaleX"
                                                data-option="-1" title="Flip Horizontal">
                                                <i class="fa fa-arrows-alt-h"></i>
                                            </button>
                                            <button type="button" class="btn btn-primary" data-method="scaleY"
                                                data-option="-1" title="Flip Vertical">
                                                <i class="fa fa-arrows-alt-v"></i>
                                            </button>
                                        </div>
                                        <button type="button" class="btn btn-primary" id="cropanh"
                                            data-method="getCroppedCanvas" data-dismiss="modal"
                                            data-option="{ &quot;width&quot;: 1000, &quot;height&quot;: 1000}">
                                            Cắt ảnh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <img alt="Blank" class="d-none" height="0" id="Cimg" src="https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png" width="0"> 
        <div class="mt-3">
            <button type="button" class="btn btn-primary disabled d-block" id="tad-taoanh"><i class="fas fa-cut"></i> Tạo
                ảnh</button>
                <div id="img-out"></div>


    <canvas id="myCanvas" width="700" height="700" style="display: none;">
        Your browser does not support the HTML5 canvas tag.
    </canvas>
    <canvas id="myCanvas2" width="2000" height="1200" style="display: none;">
        Your browser does not support the HTML5 canvas tag.
    </canvas>
    
    </div>
    <script>var tyle = 1 / 1; vmode = 1; var tenanhxuat = "cover_blackwhite";</script>

    <script>


        $("#tad-taoanh").click(function () {
            $("#cropanh").click();
       
            $("#img-out").hide();
           $("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");
          

            document.getElementById("Cimg").onload = function () {
draw()
            }



        });


        function draw() {

                var a = new Image();
                a.crossOrigin = "Anonymous";
                a.src = "https://1.bp.blogspot.com/-qrz_vIoXKCU/YU34Btum4eI/AAAAAAAAxmU/Ecjzj5UGcKQu0zEUKnH6JNrKYU0sentOACNcBGAsYHQ/s0/bg.jpg";
                a.onload = function () {

                    var b = new Image();
                    b.crossOrigin = "Anonymous";
                    b.src = "https://1.bp.blogspot.com/-W1xNQC-kmKU/YU6IOVGIhDI/AAAAAAAAxmo/JDJ20zhfDnQjvzl7WtCmphtwnogTp4STQCNcBGAsYHQ/s0/mask.png";
                    b.onload = function () {

                    var cimg = document.getElementById("Cimg");
                    var c1 = document.getElementById("myCanvas");
                    var ctx1 = c1.getContext("2d");

                  
                    ctx1.clearRect(0, 0, c1.width, c1.height);
 
  
                    ctx1.save();

                

                    ctx1.drawImage(cimg, 0, 0,c1.width,c1.height);

                    ctx1.globalCompositeOperation = "color-dodge";

                    ctx1.filter = 'invert(1) blur(3px)';

                    ctx1.drawImage(cimg, 0, 0,c1.width,c1.height);

                    ctx1.globalCompositeOperation = "color";
                    ctx1.fillStyle = "black";
                    ctx1.fillRect(0, 0, c1.width, c1.height);


                    ctx1.globalCompositeOperation = "color";

                    ctx1.fillStyle = "#89a5f6";


                    ctx1.fillRect(0, 0, c1.width, c1.height);





                    ctx1.restore();
                    ctx1.globalCompositeOperation = "destination-over";
    ctx1.fillStyle = "red";
                    ctx1.fillRect(0, 0, c1.width, c1.height);


//
                    var c2 = document.getElementById("myCanvas2");
                    var ctx2 = c2.getContext("2d");
                    ctx2.clearRect(0, 0, c2.width, c2.height);
                    ctx2.save();
                    ctx2.drawImage(a, 0, 0);
                    ctx2.globalCompositeOperation = "multiply";

                 
  
                    ctx2.save();

                    ctx2.transform(1,-0.05,0,1,0,0);
                    ctx2.drawImage(c1, 700, 330, 700, 700);

                    ctx2.restore();



                    ctx2.globalCompositeOperation = "destination-atop";
                   ctx2.drawImage(b, 0, 50, c2.width, c2.height);

                    ctx2.drawImage(a, 0, 0);
                    ctx2.restore();
                    c2.toBlob(function (l) {
                                                var k = URL.createObjectURL(l);
                                                $("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='" + k + "' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='" + k + "' class='btn btn-block btn-primary mt-2'  download='taoanhdep_" + tenanhxuat + "'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");
                                          

                                                setTimeout(function(){ 

                                                    $("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");
                                                $("#img-out").show()

                                                 }, 1000);

                                            }, "image/jpeg");

                
            }
        }  }
    </script>

</body>

</html>