<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link as='style' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css'
        media='all' rel='stylesheet' />

    <script crossorigin='anonymous'
        integrity='sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=='
        src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js'></script>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" media="all">

</head>

<body class="col-md-9">
    <link rel='stylesheet' href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.3/css/bootstrap-colorpicker.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.3/js/bootstrap-colorpicker.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" integrity="sha512-0SPWAwpC/17yYyZ/4HSllgaK7/gg9OlVozq8K7rf3J8LvCjYEEIfzzpnA2/SSjpGIunCSD18r3UhvDcu/xncWA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <script src="../testcr.js" type="text/javascript"></script>
    <script src="https://cdn.taoanhdep.com/tad/tv/tad-crop.js" type="text/javascript"></script>


    <style>.xulyhinhanh img{margin:0!important}.chonanh-avt{width:38px;height:38px;float:left;border:1px solid #ddd;border-radius:5px;overflow:hidden;margin-right:10px}.img-preview{width:36px;height:36px;background:url(//2.bp.blogspot.com/-ZTMZs1MahXE/XqZq3WgQKDI/AAAAAAAAdRI/ib4MFhw49m82VLY9b2LzZBw5w3tItLSrQCK4BGAYYCw/s36/thumbnail-man.png) no-repeat center;background-size:36px}#chonanhModal{display:block!important}#chonanhModal:not(.show){opacity:0;visibility:hidden}.img-container,.img-preview{background-color:#f7f7f7;text-align:center;width:100%}.img-container{margin-bottom:1rem;max-height:300px;min-height:280px}.img-container>img{max-width:100%}.img-preview{margin:auto!important;margin-bottom:.5rem;margin-right:.5rem;overflow:hidden}.img-preview>img{max-width:100%}
    
    
    
   #temp{position:fixed;height:0;top:0;left:0;overflow:hidden} 
    
    </style>

    <label><b>Upload ảnh*</b></label>
    <div class="xulyhinhanh mb-2">
    <div class="chonanh-avt">
        <div class="img-preview" style="width: 36px; height: 36px;"><img crossorigin="anonymous" src="https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png?timestamp=1629977090487" alt="Tạo ảnh đẹp" style="display: block; width: 100px; height: 100px; min-width: 0px !important; min-height: 0px !important; max-width: none !important; max-height: none !important; transform: none;"></div>
        </div>
        <button type="button" class="btn btn-primary btn-chonanh" data-toggle="modal" data-target="#chonanhModal">
            <i class="fas fa-upload"></i> Chọn ảnh
            </button>
            <div class="modal fade" id="chonanhModal" tabindex="-1" role="dialog" aria-labelledby="chonanhModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="chonanhModalLabel">Chọn ảnh từ thiết bị</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&#215;</span>
                </button>
                </div>
                <div class="modal-body">
                <div id="actions">
                <div class="docs-buttons">
                <label class="btn btn-primary btn-upload btn-upanh" for="inputImage" title="Upload image file">
                <input type="file" class="sr-only" id="inputImage" name="file" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff">
                <span><i class="fas fa-upload"></i> Chọn ảnh</span>
                </label>
                <div class="cropanh-container mt-2" style="display:none">
                <div class="img-container">
                <img alt="Tạo ảnh đẹp" src="https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png">
                </div>
                <div class="d-flex float-right">
                <div class="btn-group mr-2">
                <button type="button" class="btn btn-primary" data-method="rotate" data-option="-45" title="Rotate Left">
                <i class="fa fa-undo"></i>
                </button>
                <button type="button" class="btn btn-primary" data-method="rotate" data-option="45" title="Rotate Right">
                <i class="fa fa-redo"></i>
                </button>
                </div>
                <div class="btn-group mr-2">
                <button type="button" class="btn btn-primary" data-method="scaleX" data-option="-1" title="Flip Horizontal">
                <i class="fa fa-arrows-alt-h"></i>
                </button>
                <button type="button" class="btn btn-primary" data-method="scaleY" data-option="-1" title="Flip Vertical">
                <i class="fa fa-arrows-alt-v"></i>
                </button>
                </div>
                <button type="button" class="btn btn-primary" id="cropanh" data-method="getCroppedCanvas" data-dismiss="modal" data-option="{ &quot;width&quot;: 1000, &quot;height&quot;: 1000}">
                Cắt ảnh
                </button>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
            </div>

    <label><b>Nhập tên*</b></label>
    <input type="text" class="form-control tad-in-text1 mb-3" placeholder="Nhập tên">
    <input type="text" class="form-control tad-in-text2 mb-3" placeholder="Nhập tên phụ">
    <label><b>Nhập thông tin*</b></label>
    <input type="text" class="form-control tad-in-text3 mb-3" placeholder="Nhập số điện thoại">
    <input type="text" class="form-control tad-in-text4 mb-3" placeholder="Nhập số email">
    <input type="text" class="form-control tad-in-text5 mb-3" placeholder="Nhập vị trí">
    <label>Đổi màu</label>
    <input type="text" class="form-control tad-in-color1 mb-3" value="#ffffff" placeholder="Nhập mã màu">
    <button type="button" class="btn btn-primary disabled" id="tad-taoanh"><i class="fas fa-cut"></i> Tạo ảnh</button>


    <img id="Cimg" style="display: none;" width="220" height="277"
        src="https://gamek.mediacdn.vn/133514250583805952/2021/7/29/photo-1-16275418795411403527390.jpg"
        alt="The Scream">


    <canvas id="temp" width="1700" height="630" style="border:1px solid #d3d3d3;">
        Your browser does not support the HTML canvas tag.</canvas>
        <div id="img-out"></div>
    <script>
var tyle= 1/1; vmode = 1;
var tenanhxuat = "cover_abstract";


$(".tad-in-color1").colorpicker().change(function() {
            var a = $(".tad-in-color1").val();
            $(".demomau").css("background-color", a);

        });


        $("#tad-taoanh").click(function() {


 if($(".tad-in-text1").val() == "" || $(".tad-in-text2").val() == "" || $(".tad-in-text3").val() == "" || $(".tad-in-text4").val() == "" || $(".tad-in-text5").val() == "" ){

   alert("Vui lòng nhập đủ thông tin")

  return false;
}



            $("#cropanh").click();
            $("#img-out").hide();
            $("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");
           



            draw();

            
        });

function draw(){

    var t1 = $(".tad-in-text1").val().toUpperCase();
        var t2 = $(".tad-in-text2").val().toUpperCase();
        var t3 = $(".tad-in-text3").val();
        var t4 = $(".tad-in-text4").val();
        var t5 = $(".tad-in-text5").val().toUpperCase();

        var color1 = $(".tad-in-color1").val()



        document.fonts.load('10pt "UTM-Avo"').then(function () {



            var cimg = document.getElementById("Cimg");
            cimg.crossOrigin = "Anonymous";
            cimg.onload = function () {

                var a = new Image();
                a.crossOrigin = "Anonymous";
                a.src = "https://1.bp.blogspot.com/-ZyXHJE2S3ew/YSdA8Guah-I/AAAAAAAAwtQ/udZEj3sXhQkwh5Qn8jwfjRwesrGoY90cwCNcBGAsYHQ/s0/bg.jpg";
                a.onload = function () {


                    var b = new Image();
                    b.crossOrigin = "Anonymous";
                    b.src = "https://1.bp.blogspot.com/-zl3qntcfDhY/YSdEQNehJJI/AAAAAAAAwtY/C17yMRMBjGstL_Cq6STfSYyBy-mwjkdQwCNcBGAsYHQ/s0/mask.png";
                    b.onload = function () {

                        var c = document.getElementById("temp");
                        var ctx = c.getContext("2d");

                        ctx.clearRect(0, 0, c.width, c.height);




                        ctx.save();
                        ctx.drawImage(a, 0, 0, c.width, c.height);

                        ctx.strokeStyle = "rgb(255 255 255 / 7%)";
                        ctx.lineWidth = 3;
                        ctx.font = "900 100px UTM-Avo";
                        ctx.strokeText(t1, 30, 100);
                        ctx.strokeText(t1, 130, 200);

                        ctx.textAlign = "right";
                        ctx.strokeText(t1, c.width - 30, c.height - 30);
                        ctx.strokeText(t1, c.width - 130, c.height - 130);

                        ctx.globalCompositeOperation = "destination-out";
                        ctx.drawImage(b, 0, 0, c.width, c.height);

                        ctx.restore();


                        ctx.save();
                        ctx.globalCompositeOperation = "destination-over";
                        ctx.fillStyle = color1;

                        ctx.fillRect(0, 0, c.width, c.height);
                        ctx.restore();


                        ctx.save();
                        ctx.font = "900 55px UTM-Avo";
                        ctx.fillStyle = color1;
                        ctx.textAlign = "right";
                        ctx.fillText(t1, 680, 270);
                        ctx.restore();

                        ctx.save();
                        ctx.font = "900 40px UTM-Avo";
                        ctx.fillStyle = "#fff";
                        ctx.textAlign = "right";
                        ctx.fillText(t2, 680, 320);
                        ctx.restore();

                        ctx.save();
                        ctx.font = "23px UTM-Avo";
                        ctx.fillStyle = "#fff";
                        ctx.fillText(t3, 1350, 252);
                        ctx.fillText(t4, 1350, 332);
                        ctx.fillText(t5, 1350, 410);


                        ctx.restore();




                        ctx.save();

                        var sizeavt = 285;

                        ctx.translate(825, 180);
                        ctx.beginPath();
                        ctx.arc(sizeavt / 2, sizeavt / 2, sizeavt / 2, 0, Math.PI * 2, true);
                        ctx.closePath();
                        ctx.clip();

                        ctx.drawImage(cimg, 0, 0, sizeavt, sizeavt);
                        ctx.restore();

                        c.toBlob(function(i) {
                            var f = URL.createObjectURL(i);
                            $("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='" + f + "' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='" + f + "' class='btn btn-block btn-primary mt-2'  download='taoanhdep_" + tenanhxuat + "'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");
                          


                            setTimeout(function() {
                                $("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");
                            $("#img-out").show()
              
            }, 1000)

                        }, "image/jpeg")


                    }
                }
            }

        });

}

    </script>


</body>

</html>