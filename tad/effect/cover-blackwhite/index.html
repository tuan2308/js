<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link as='style' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css'
        media='all' rel='stylesheet' />

    <script crossorigin='anonymous'
        integrity='sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=='
        src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js'></script>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" media="all">

</head>

<body>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" integrity="sha512-0SPWAwpC/17yYyZ/4HSllgaK7/gg9OlVozq8K7rf3J8LvCjYEEIfzzpnA2/SSjpGIunCSD18r3UhvDcu/xncWA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <script src="../testcr.js" type="text/javascript"></script>
    <script src="https://cdn.taoanhdep.com/tad/tv/tad-crop.js" type="text/javascript"></script>



    <label>Upload ảnh</label>
    <div class="xulyhinhanh mb-2">
    <div class="chonanh-avt">
        <div class="img-preview" style="width: 36px; height: 36px;"><img crossorigin="anonymous" src="https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png?timestamp=1629977090487" alt="Tạo ảnh đẹp" style="display: block; width: 100px; height: 100px; min-width: 0px !important; min-height: 0px !important; max-width: none !important; max-height: none !important; transform: none;"></div>
        </div>
        <button type="button" class="btn btn-primary btn-chonanh" data-toggle="modal" data-target="#chonanhModal">
            <i class="fas fa-upload"></i> Chọn ảnh
            </button>
            <div class="modal fade" id="chonanhModal" tabindex="-1" role="dialog" aria-labelledby="chonanhModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="chonanhModalLabel">Chọn ảnh từ thiết bị</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&#215;</span>
                </button>
                </div>
                <div class="modal-body">
                <div id="actions">
                <div class="docs-buttons">
                <label class="btn btn-primary btn-upload btn-upanh" for="inputImage" title="Upload image file">
                <input type="file" class="sr-only" id="inputImage" name="file" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff">
                <span><i class="fas fa-upload"></i> Chọn ảnh</span>
                </label>
                <div class="cropanh-container mt-2" style="display:none">
                <div class="img-container">
                <img alt="Tạo ảnh đẹp" src="https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png">
                </div>
                <div class="d-flex float-right">
                <div class="btn-group mr-2">
                <button type="button" class="btn btn-primary" data-method="rotate" data-option="-45" title="Rotate Left">
                <i class="fa fa-undo"></i>
                </button>
                <button type="button" class="btn btn-primary" data-method="rotate" data-option="45" title="Rotate Right">
                <i class="fa fa-redo"></i>
                </button>
                </div>
                <div class="btn-group mr-2">
                <button type="button" class="btn btn-primary" data-method="scaleX" data-option="-1" title="Flip Horizontal">
                <i class="fa fa-arrows-alt-h"></i>
                </button>
                <button type="button" class="btn btn-primary" data-method="scaleY" data-option="-1" title="Flip Vertical">
                <i class="fa fa-arrows-alt-v"></i>
                </button>
                </div>
                <button type="button" class="btn btn-primary" id="cropanh" data-method="getCroppedCanvas" data-dismiss="modal" data-option="{ &quot;width&quot;: 1000, &quot;height&quot;: 1000}">
                Cắt ảnh
                </button>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
            </div>

    <label><b>Nhập tên*</b></label>
    <input type="text" class="form-control tad-in-text1 mb-2" placeholder="Nhập tên">
    
    
    <label>Nhập mô tả</label>
    <textarea class="form-control tad-out-texta" rows="3" placeholder="Nhập caption">Nhận tất cả dịch vụ về xương khớp
Receive all osteoarthritis services
        </textarea>

        <label>Nhập thông tin</label>
        <input type="text" class="form-control tad-in-text2 mb-2" placeholder="facebook">
        <input type="text" class="form-control tad-in-text3 mb-2" placeholder="phone">
        <input type="text" class="form-control tad-in-text4 mb-2" placeholder="mail">
        <input type="text" class="form-control tad-in-text5 mb-2" placeholder="local">


        <div class="mt-3">
            <button type="button" class="btn btn-primary disabled d-block" id="tad-taoanh"><i class="fas fa-cut"></i> Tạo
                ảnh</button>
        </div>
        <div id="img-out"></div>

    <img id="Cimg" width="0" height="0"
        src="https://1.bp.blogspot.com/-2hrD12OymIQ/YTHhD8SsoMI/AAAAAAAAw9E/ShopLf-YTHw2Ep5d0jE_RzcYCRkERtt4ACNcBGAsYHQ/s0/avt.jpg"
        class="d-none" alt="The Scream">


    <canvas id="temp" width="2000" height="760" style="display: none;"></canvas>

    <script>
var tyle= 1/1; vmode = 1;
var tenanhxuat = "cover_blackwhite";


var t1= "Trương Ngọc Tuấn";

var texta = $(".tad-out-texta").val();

var t2= "@facebook";
var t3= "@phone";
var t4= "@mail";
var t5= "@local";

$(".tad-in-text1").on("input",function(){

if($(".tad-in-text1").val() == ""){
$("#tad-taoanh").addClass("disabled")
console.log("1")
}
else{$("#tad-taoanh").removeClass("disabled")


}

    });

$("#tad-taoanh").click(function() {

  
if($(".tad-in-text1").val() == "" ){
  alert("Vui lòng nhập tên")
  $(".tad-in-text1").focus();
 return false;
}



       
           $("#img-out").hide();
           $("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");
          



           draw();

           
       });

function draw(){
        document.fonts.load('10pt "UTM-Avo"').then(function () {


            var cimg = document.getElementById("Cimg");
            cimg.crossOrigin = "Anonymous";
            cimg.onload = function () {



                var a = new Image();
                a.crossOrigin = "Anonymous";
                a.src = "https://1.bp.blogspot.com/-i2WXgwKuDYw/YTMZ4zHLLAI/AAAAAAAAw9w/s88e0j38z_QFgcxqkvtg5DLFYBebGkj7ACNcBGAsYHQ/s0/bg.png";
                a.onload = function () {

                    var b = new Image();
                    b.crossOrigin = "Anonymous";
                    b.src = "https://1.bp.blogspot.com/-KInPt84lAkw/YTHe56D_j9I/AAAAAAAAw88/sg1-Z3A8yKAEOSbWLM84ikPtc0rnUmIbQCNcBGAsYHQ/s0/mask.png";
                    b.onload = function () {

                        var cc = new Image();
                    cc.crossOrigin = "Anonymous";
                    cc.src = "https://1.bp.blogspot.com/-C6ac9ris0sc/YTMchbZOJ1I/AAAAAAAAw94/9PLlIZNcrLUpsDyJS9r5bYG6__JMGHjBgCNcBGAsYHQ/s0/tich.png";
                    cc.onload = function () {


                        var c = document.getElementById("temp");
                        var ctx = c.getContext("2d");
                        ctx.clearRect(0, 0, c.width, c.height);

                        ctx.save();

                        ctx.drawImage(cimg, 800, 100, 430, 430);
                        ctx.globalCompositeOperation = "destination-atop";
                        ctx.drawImage(b, 0, 0, c.width, c.height);

                        ctx.drawImage(a, 0, 0, c.width, c.height);


                        ctx.restore();
                        ctx.save();
               
                        ctx.font = "50px UTM-Avo";
                        ctx.fillStyle = "black";
                        var tw = ctx.measureText(t1).width;
                        ctx.fillText(t1, 50, 83);

                        
                        ctx.restore();

                        ctx.drawImage(cc, tw + 60, 42, 47, 47);


                        ctx.save();
                        ctx.font = "30px UTM-Avo";
                        ctx.fillStyle = "black";
                       
                        ctx.fillText(t2, 490, 630);
                        ctx.fillText(t3, 870, 630);
                        ctx.fillText(t4, 1240, 630);
                        ctx.fillText(t5, 1620, 630);
                        ctx.restore();

                        ctx.save();
                        ctx.font = '27px UTM-Avo';
                        var x = 50;
                        var y = 130;
                        var lineheight = 30;
                        var lines = texta.split('\n');
       
                        for (var i = 0; i < lines.length; i++)

                            ctx.fillText(lines[i], x, y + (i * lineheight));

                        ctx.restore();

                        ctx.globalCompositeOperation = "hue";
                        ctx.fillRect(0, 0, c.width, c.height);


                        c.toBlob(function (l) {
                                                var k = URL.createObjectURL(l);
                                                $("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='" + k + "' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='" + k + "' class='btn btn-block btn-primary mt-2'  download='taoanhdep_" + tenanhxuat + "'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");
                                                $("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");
                                                $("#img-out").show()
                                            }, "image/jpeg");

                    }
                    }
                }
            }
        })
    }


    </script>



</body>

</html>