$(document).ready(function(){if(window.location.hostname==tmbq){$("head").append(cssCrop);$("head").append(jsCrop);$("head").append(jqueryCrop);$("#tad-taoanh").click(function(){$("#cropanh").click();$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");setTimeout(function(){g()},200)});var k=document.getElementById("Cimg");var h=document.getElementById("Bimg");var i=document.getElementById("Limg");var f=document.getElementById("Nimg");function g(){c=document.querySelector("canvas"),ctx=c.getContext("2d"),corners=[{x:-20,y:150},{x:1161,y:272},{x:1106,y:863},{x:66,y:1031}],corners1=[{x:1893,y:326},{x:1222,y:280},{x:1173,y:850},{x:1821,y:694}],step=1;a();function a(){var e,j,v,z,A,d,s,u,w=k.width-1,t=k.height-1;ctx.clearRect(0,0,c.width,c.height);ctx.save();ctx.drawImage(h,0,0,c.width,c.height);for(y=0;y<t;y+=step){for(x=0;x<w;x+=step){A=b(corners[0],corners[3],y/t);d=b(corners[1],corners[2],y/t);s=b(corners[0],corners[3],(y+step)/t);u=b(corners[1],corners[2],(y+step)/t);e=b(A,d,x/w);j=b(A,d,(x+step)/w);v=b(s,u,(x+step)/w);z=b(s,u,x/w);ctx.drawImage(k,x,y,step,step,e.x,e.y,Math.ceil(Math.max(step,Math.abs(j.x-e.x),Math.abs(z.x-v.x)))+1,Math.ceil(Math.max(step,Math.abs(e.y-z.y),Math.abs(j.y-v.y)))+1)}}for(y=0;y<t;y+=step){for(x=0;x<w;x+=step){A=b(corners1[0],corners1[3],y/t);d=b(corners1[1],corners1[2],y/t);s=b(corners1[0],corners1[3],(y+step)/t);u=b(corners1[1],corners1[2],(y+step)/t);e=b(A,d,x/w);j=b(A,d,(x+step)/w);v=b(s,u,(x+step)/w);z=b(s,u,x/w);ctx.drawImage(k,x,y,step,step,e.x,e.y,Math.ceil(Math.max(step,Math.abs(j.x-e.x),Math.abs(z.x-v.x)))+1,Math.ceil(Math.max(step,Math.abs(e.y-z.y),Math.abs(j.y-v.y)))+1)}}ctx.save();ctx.globalAlpha=0.8;ctx.drawImage(f,0,0,c.width,c.height);ctx.restore();ctx.save();ctx.drawImage(i,0,0,c.width,c.height);ctx.restore();c.toBlob(function(l){var m=URL.createObjectURL(l);$("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='"+m+"' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='"+m+"' class='btn btn-block btn-primary mt-2'  download='taoanhdep_"+tenanhxuat+"'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");$("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");$("#img-out").show()},"image/jpeg")}function b(d,e,j){return{x:d.x+(e.x-d.x)*j,y:d.y+(e.y-d.y)*j}}}}});