$(document).ready(function(){if(window.location.hostname==tmbq){$("head").append(cssCrop);$("head").append(jsCrop);$("head").append(jqueryCrop);$("#tad-taoanh").click(function(){$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");setTimeout(function(){a()},200)});var d=document.getElementById("Cimg");var j=document.getElementById("Bimg");var e=document.getElementById("Limg");var b=document.getElementById("Nimg");function a(){c=document.querySelector("canvas"),ctx=c.getContext("2d"),corners=[{x:-20,y:150},{x:1161,y:272},{x:1106,y:863},{x:66,y:1031}],corners1=[{x:1893,y:326},{x:1222,y:280},{x:1173,y:850},{x:1821,y:694}],step=1;g();function g(){var q,p,l,i,h,r,o,m,k=d.width-1,n=d.height-1;ctx.clearRect(0,0,c.width,c.height);ctx.save();ctx.drawImage(j,0,0,c.width,c.height);for(y=0;y<n;y+=step){for(x=0;x<k;x+=step){h=f(corners[0],corners[3],y/n);r=f(corners[1],corners[2],y/n);o=f(corners[0],corners[3],(y+step)/n);m=f(corners[1],corners[2],(y+step)/n);q=f(h,r,x/k);p=f(h,r,(x+step)/k);l=f(o,m,(x+step)/k);i=f(o,m,x/k);ctx.drawImage(d,x,y,step,step,q.x,q.y,Math.ceil(Math.max(step,Math.abs(p.x-q.x),Math.abs(i.x-l.x)))+1,Math.ceil(Math.max(step,Math.abs(q.y-i.y),Math.abs(p.y-l.y)))+1)}}for(y=0;y<n;y+=step){for(x=0;x<k;x+=step){h=f(corners1[0],corners1[3],y/n);r=f(corners1[1],corners1[2],y/n);o=f(corners1[0],corners1[3],(y+step)/n);m=f(corners1[1],corners1[2],(y+step)/n);q=f(h,r,x/k);p=f(h,r,(x+step)/k);l=f(o,m,(x+step)/k);i=f(o,m,x/k);ctx.drawImage(d,x,y,step,step,q.x,q.y,Math.ceil(Math.max(step,Math.abs(p.x-q.x),Math.abs(i.x-l.x)))+1,Math.ceil(Math.max(step,Math.abs(q.y-i.y),Math.abs(p.y-l.y)))+1)}}ctx.save();ctx.globalAlpha=0.8;ctx.drawImage(b,0,0,c.width,c.height);ctx.restore();ctx.save();ctx.drawImage(e,0,0,c.width,c.height);ctx.restore();c.toBlob(function(v){var s=URL.createObjectURL(v);$("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='"+s+"' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='"+s+"' class='btn btn-block btn-primary mt-2'  download='taoanhdep_"+tenanhxuat+"'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");$("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");$("#img-out").show()})}function f(k,i,h){return{x:k.x+(i.x-k.x)*h,y:k.y+(i.y-k.y)*h}}}}});