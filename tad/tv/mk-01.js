$(document).ready(function(){if (window.location.hostname==tmbq){$("head").append(cssCrop);$("head").append(jsCrop);$("head").append(jqueryCrop);var a=document.getElementById("Nimg");var g=document.getElementById("Cimg");var h=vitri;$("#tad-taoanh").click(function(){$("#cropanh").click();h=vitri;$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> "+tdta);setTimeout(function(){f()}, 200)});function f(){var b=new Image();b.crossOrigin="Anonymous";b.src=markimg;b.onload=function(){var d=new Image();d.crossOrigin="Anonymous";d.src=bgimg;d.onload=function(){c=document.querySelector("canvas"), ctx=c.getContext("2d"), corners=h, step=1;var m, w, t, C, u, k, o, v, z=g.width - 1,j=g.height - 1;ctx.clearRect(0, 0, c.width, c.height);ctx.save();for (y=0; y < j; y +=step){for (x=0; x < z; x +=step){u=i(corners[0], corners[3], y / j);k=i(corners[1], corners[2], y / j);o=i(corners[0], corners[3], (y + step) / j);v=i(corners[1], corners[2], (y + step) / j);m=i(u, k, x / z);w=i(u, k, (x + step) / z);t=i(o, v, (x + step) / z);C=i(o, v, x / z);ctx.drawImage(g, x, y, step, step, m.x, m.y, Math.ceil(Math.max(step, Math.abs(w.x - m.x), Math.abs(C.x - t.x))) + 1, Math.ceil(Math.max(step, Math.abs(m.y - C.y), Math.abs(w.y - t.y))) + 1)}}if (tadMk=="black"){ctx.save();ctx.globalAlpha=0.3;ctx.fillStyle="#333";ctx.fillRect(0, 0, c.width, c.height);ctx.restore()}ctx.globalCompositeOperation="destination-in";ctx.drawImage(b, 0, 0, c.width, c.height);ctx.restore();ctx.save();ctx.globalCompositeOperation="destination-over";ctx.drawImage(d, 0, 0, c.width, c.height);ctx.restore();if (a){ctx.save();ctx.globalAlpha=0.5;var e=ctx.createPattern(a, "repeat");ctx.fillStyle=e;ctx.fillRect(0, 0, c.width, c.height);ctx.restore()}c.toBlob(function(l){var n=URL.createObjectURL(l);$("#img-out").html("<label class='mt-2'>+tkq+</label><img src='" + n + "' alt='taoanhdep' class='img-thumbnail'></img><a href='" + n + "' class='btn btn-block btn-primary mt-2' download='taoanhdep_" + tax + "'><i class='fas fa-cloud-download-alt'></i> +ttav+</a>");$("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> "+tta);$("#img-out").show()}, "image/jpeg");function i(p, l, n){return{x: p.x + (l.x - p.x) * n,y: p.y + (l.y - p.y) * n}}}}}}});