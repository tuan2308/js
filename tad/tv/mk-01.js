$(document).ready(function(){if(window.location.hostname==tmbq){$("head").append(cssCrop);$("head").append(jsCrop);$("head").append(jqueryCrop);$("body").append("<img src='https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png' crossorigin='anonymous' id='Mimg' class='d-none'/>");$("body").append("<img src='https://1.bp.blogspot.com/-z3RZ2G93tVo/YHES6yUdnzI/AAAAAAAArsw/Jq_pD24Pn-sEW-XwzGl18qlgIYQZZOeqgCNcBGAsYHQ/s0/blank.png' crossorigin='anonymous' id='Bimg' class='d-none'/>");var b=document.getElementById("Nimg");var e=document.getElementById("Cimg");var k=document.getElementById("Bimg");var a=document.getElementById("Mimg");var d=vitri;window.onscroll=function(){var f=$(".xulyhinhanh").get(0).getBoundingClientRect();if(f.top<window.innerHeight){$("#Bimg").attr("src",bgimg);$("#Mimg").attr("src",markimg);window.onscroll=null}};$("#tad-taoanh").click(function(){$("#Bimg").attr("src",bgimg);$("#Mimg").attr("src",markimg);d=vitri;$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");setTimeout(function(){k.onload=j()},200)});function j(){c=document.querySelector("canvas"),ctx=c.getContext("2d"),corners=d,step=1;var h,n,A,l,f,i,p,s,g=e.width-1,B=e.height-1;ctx.clearRect(0,0,c.width,c.height);ctx.save();for(y=0;y<B;y+=step){for(x=0;x<g;x+=step){f=q(corners[0],corners[3],y/B);i=q(corners[1],corners[2],y/B);p=q(corners[0],corners[3],(y+step)/B);s=q(corners[1],corners[2],(y+step)/B);h=q(f,i,x/g);n=q(f,i,(x+step)/g);A=q(p,s,(x+step)/g);l=q(p,s,x/g);ctx.drawImage(e,x,y,step,step,h.x,h.y,Math.ceil(Math.max(step,Math.abs(n.x-h.x),Math.abs(l.x-A.x)))+1,Math.ceil(Math.max(step,Math.abs(h.y-l.y),Math.abs(n.y-A.y)))+1)}}if(tadMk=="black"){ctx.save();ctx.globalAlpha=0.3;ctx.fillStyle="#333";ctx.fillRect(0,0,c.width,c.height);ctx.restore()}ctx.globalCompositeOperation="destination-in";ctx.drawImage(a,0,0,c.width,c.height);ctx.restore();ctx.save();ctx.globalCompositeOperation="destination-over";ctx.drawImage(k,0,0,c.width,c.height);ctx.restore();if(b){ctx.save();ctx.globalAlpha=0.5;var r=ctx.createPattern(b,"repeat");ctx.fillStyle=r;ctx.fillRect(0,0,c.width,c.height);ctx.restore()}c.toBlob(function(m){var o=URL.createObjectURL(m);$("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='"+o+"' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='"+o+"' class='btn btn-block btn-primary mt-2'  download='taoanhdep_"+tenanhxuat+"'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");$("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");$("#img-out").show()},"image/jpeg");function q(t,o,m){return{x:t.x+(o.x-t.x)*m,y:t.y+(o.y-t.y)*m}}}}});