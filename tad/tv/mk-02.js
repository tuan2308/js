$(document).ready(function(){if(window.location.hostname==tmbq){$("head").append(cssCrop);$("head").append(jsCrop);$("head").append(jqueryCrop);var a=document.getElementById("Nimg");var g=document.getElementById("Cimg");var h=vitri;$("#tad-taoanh").click(function(){h=vitri;$("#img-out").hide();$("#tad-taoanh").addClass("disabled").html("<span class='spinner-border spinner-border-sm'></span> Đang tạo ảnh");setTimeout(function(){f()},200)});function f(){var b=new Image();b.crossOrigin="Anonymous";b.src=markimg;b.onload=function(){var d=new Image();d.crossOrigin="Anonymous";d.src=bgimg;d.onload=function(){c=document.querySelector("canvas"),ctx=c.getContext("2d"),corners=h,step=1;var w,t,o,u,C,v,m,D,z=g.width-1,k=g.height-1;ctx.clearRect(0,0,c.width,c.height);ctx.save();for(y=0;y<k;y+=step){for(x=0;x<z;x+=step){C=j(corners[0],corners[3],y/k);v=j(corners[1],corners[2],y/k);m=j(corners[0],corners[3],(y+step)/k);D=j(corners[1],corners[2],(y+step)/k);w=j(C,v,x/z);t=j(C,v,(x+step)/z);o=j(m,D,(x+step)/z);u=j(m,D,x/z);ctx.drawImage(g,x,y,step,step,w.x,w.y,Math.ceil(Math.max(step,Math.abs(t.x-w.x),Math.abs(u.x-o.x)))+1,Math.ceil(Math.max(step,Math.abs(w.y-u.y),Math.abs(t.y-o.y)))+1)}}if(tadMk=="black"){ctx.save();ctx.globalAlpha=0.3;ctx.fillStyle="#333";ctx.fillRect(0,0,c.width,c.height);ctx.restore()}ctx.globalCompositeOperation="destination-in";ctx.drawImage(b,0,0,c.width,c.height);ctx.restore();ctx.save();ctx.globalCompositeOperation="destination-over";ctx.drawImage(d,0,0,c.width,c.height);ctx.restore();if(a){ctx.save();ctx.globalAlpha=0.5;var e=ctx.createPattern(a,"repeat");ctx.fillStyle=e;ctx.fillRect(0,0,c.width,c.height);ctx.restore()}c.toBlob(function(i){var l=URL.createObjectURL(i);$("#img-out").html("<label class='mt-2'> Kết quả: </label><img src='"+l+"' alt='Tạo ảnh đẹp' class='img-thumbnail'></img><a href='"+l+"' class='btn btn-block btn-primary mt-2'  download='taoanhdep_"+tenanhxuat+"'><i class='fas fa-cloud-download-alt'></i> Tải ảnh về</a>");$("#tad-taoanh").removeClass("disabled").html("<i class='fas fa-cut'></i> Tạo ảnh");$("#img-out").show()},"image/jpeg");function j(l,n,i){return{x:l.x+(n.x-l.x)*i,y:l.y+(n.y-l.y)*i}}}}}}});